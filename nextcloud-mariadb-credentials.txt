Nextcloud with MariaDB + Redis (Developer Sandbox - Scalable)
=============================================================
URL: https://nextcloud-ryan-nix-dev.apps.rm3.7wse.p1.openshiftapps.com
Username: admin
Password: 1zdFGw1ocDdYrr9s
Namespace: ryan-nix-dev

Architecture:
-------------
Nextcloud Replicas: 1
Storage: EFS (efs-sc) - ReadWriteMany
Database: MariaDB 10.11 (SCLORG) - gp3
Cache: Redis 6 (SCLORG)

Database Information:
---------------------
Host: mariadb
Port: 3306
Database: nextcloud
DB User: nextcloud
DB Password: xBnF6lA59Hx4wU

Redis Information:
------------------
Host: redis
Port: 6379
Password: Zjz26ieGimvCOYo2

Generated: Mon Dec  8 07:42:20 CST 2025

Applied Fixes:
--------------
1. Service targetPort: 9000 -> 8080 (nginx, not PHP-FPM)
2. Probe ports: 9000 -> 8080
3. Probe Host header: Added "Host: localhost"
4. Disabled data directory permission check
5. Trusted domains: localhost, 127.0.0.1, external hostname, service names

Scaling Commands:
-----------------
# Scale up to 3 replicas
oc scale deploy/nextcloud --replicas=3

# Scale down to 1 replica
oc scale deploy/nextcloud --replicas=1

# Check current replicas
oc get deploy nextcloud

Troubleshooting Commands:
-------------------------
# Check all pods
oc get pods

# View Nextcloud logs
oc logs deploy/nextcloud -c nextcloud
oc logs deploy/nextcloud -c nextcloud-nginx

# View MariaDB logs
oc logs deploy/mariadb

# View Redis logs
oc logs deploy/redis

# Connect to MariaDB
oc exec -it deploy/mariadb -- mysql -u nextcloud -pxBnF6lA59Hx4wU nextcloud

# Test Redis
oc exec deploy/redis -- redis-cli -a Zjz26ieGimvCOYo2 ping

# Test health endpoint
oc exec deploy/nextcloud -c nextcloud-nginx -- curl -s -H "Host: localhost" http://localhost:8080/status.php

# Check trusted domains
oc exec deploy/nextcloud -c nextcloud -- cat /var/www/html/config/config.php | grep -A10 trusted_domains

# Verify Redis is being used
oc exec deploy/nextcloud -c nextcloud -- cat /var/www/html/config/config.php | grep -A10 redis

# Restart deployments
oc rollout restart deploy/nextcloud
oc rollout restart deploy/mariadb
oc rollout restart deploy/redis
